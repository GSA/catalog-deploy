---

# locate tracking urls in three js files, replace them with 
# urls from wrtiable instances.
- name: replace readonly tracking url to the writable one
  replace:
    path: "{{ item.path }}"
    regexp: "{{ item.regexp }}"
    replace: "{{ item.replace }}"
  with_items:
    - path: /usr/lib/ckan/src/ckanext-datagovtheme/ckanext/datagovtheme/fanstatic_library/scripts/tracking.js
      regexp: '\$\.ajax\({url : ''/_tracking\'','
      replace: "$.ajax({url : '{{ urls_private.catalog }}/_tracking',"
    - path: /usr/lib/ckan/src/ckan/ckan/public/base/javascript/tracking.js
      regexp: '\$\(''body''\)\.data\(''site-root''\) \+ ''_tracking'''
      replace: "'{{ urls_private.catalog }}/_tracking'"
    - path: /usr/lib/ckan/src/ckan/ckan/public/base/javascript/tracking.min.js
      regexp: '\$\(''body''\)\.data\(''site-root''\)\+''_tracking'''
      replace: "'{{ urls_private.catalog }}/_tracking'"
  when: readwrite_type == "readonly"
